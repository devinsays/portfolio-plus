!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(c,d){"use strict";c.infinitescroll=function(e,t,i){this.element=c(i),this._create(e,t)||(this.failed=!0)},c.infinitescroll.defaults={loading:{finished:d,finishedMsg:"",img:"",msg:null,msgText:"",selector:null,speed:"fast",start:d},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,isBeyondMaxPage:!1,currPage:1},debug:!1,behavior:d,binder:c(window),nextSelector:".nav-previous a",navSelector:"#nav-below",contentSelector:null,extraScrollPx:150,itemSelector:".hentry",animate:!1,pathParse:d,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:d,path:d,prefill:!1,maxPage:d},c.infinitescroll.prototype={_binding:function(e){var t=this,i=t.options;return i.v="2.0b2.120520",i.behavior&&this["_binding_"+i.behavior]!==d?void this["_binding_"+i.behavior].call(this):"bind"!==e&&"unbind"!==e?(this._debug("Binding value  "+e+" not valid"),!1):("unbind"===e?this.options.binder.unbind("smartscroll.infscr."+t.options.infid):this.options.binder[e]("smartscroll.infscr."+t.options.infid,function(){t.scroll()}),void this._debug("Binding",e))},_create:function(e,o){var n=c.extend(!0,{},c.infinitescroll.defaults,e);this.options=n;var a=c(window);if(!this._validate(e))return!1;var t=c(n.nextSelector).attr("href");if(!t)return this._debug("Navigation selector not found"),!1;n.path=n.path||this._determinepath(t),n.contentSelector=n.contentSelector||this.element,n.loading.selector=n.loading.selector||n.contentSelector,n.loading.msg=n.loading.msg||c('<div id="infscr-loading"><img alt="Loading..." src="'+n.loading.img+'" /><div>'+n.loading.msgText+"</div></div>"),(new Image).src=n.loading.img,n.pixelsFromNavToBottom===d&&(n.pixelsFromNavToBottom=c(document).height()-c(n.navSelector).offset().top,this._debug("pixelsFromNavToBottom: "+n.pixelsFromNavToBottom));var i=this;return n.loading.start=n.loading.start||function(){c(n.navSelector).hide(),n.loading.msg.appendTo(n.loading.selector).show(n.loading.speed,c.proxy(function(){this.beginAjax(n)},i))},n.loading.finished=n.loading.finished||function(){n.state.isBeyondMaxPage||n.loading.msg.fadeOut(n.loading.speed)},n.callback=function(e,t,i){n.behavior&&e["_callback_"+n.behavior]!==d&&e["_callback_"+n.behavior].call(c(n.contentSelector)[0],t,i),o&&o.call(c(n.contentSelector)[0],t,n,i),n.prefill&&a.bind("resize.infinite-scroll",e._prefill)},e.debug&&(!Function.prototype.bind||"object"!=typeof console&&"function"!=typeof console||"object"!=typeof console.log||["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind)),this._setup(),n.prefill&&this._prefill(),!0},_prefill:function(){function e(){return t.options.contentSelector.height()<=i.height()}var t=this,i=c(window);this._prefill=function(){e()&&t.scroll(),i.bind("resize.infinite-scroll",function(){e()&&(i.unbind("resize.infinite-scroll"),t.scroll())})},this._prefill()},_debug:function(){!0===this.options.debug&&("undefined"!=typeof console&&"function"==typeof console.log?1===Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?console.log(Array.prototype.slice.call(arguments).toString()):console.log(Array.prototype.slice.call(arguments)):Function.prototype.bind||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments)))},_determinepath:function(e){var t=this.options;if(t.behavior&&this["_determinepath_"+t.behavior]!==d)return this["_determinepath_"+t.behavior].call(this,e);if(t.pathParse)return this._debug("pathParse manual"),t.pathParse(e,this.options.state.currPage+1);if(e.match(/^(.*?)\b2\b(.*?$)/))e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/))return e.match(/^(.*?page=)2(\/.*|$)/).slice(1);e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/))return e.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com."),t.state.isInvalidPage=!0}return this._debug("determinePath",e),e},_error:function(e){var t=this.options;return t.behavior&&this["_error_"+t.behavior]!==d?void this["_error_"+t.behavior].call(this,e):("destroy"!==e&&"end"!==e&&(e="unknown"),this._debug("Error",e),("end"===e||t.state.isBeyondMaxPage)&&this._showdonemsg(),t.state.isDone=!0,t.state.currPage=1,t.state.isPaused=!1,t.state.isBeyondMaxPage=!1,void this._binding("unbind"))},_loadcallback:function(e,t,i){var o,n=this.options,a=this.options.callback,s=n.state.isDone?"done":n.appendCallback?"append":"no-append";if(n.behavior&&this["_loadcallback_"+n.behavior]!==d)this["_loadcallback_"+n.behavior].call(this,e,t);else{switch(s){case"done":return this._showdonemsg(),!1;case"no-append":"html"===n.dataType&&(t=c(t="<div>"+t+"</div>").find(n.itemSelector));break;case"append":var r=e.children();if(0===r.length)return this._error("end");for(o=document.createDocumentFragment();e[0].firstChild;)o.appendChild(e[0].firstChild);this._debug("contentSelector",c(n.contentSelector)[0]),c(n.contentSelector)[0].appendChild(o),t=r.get()}if(n.loading.finished.call(c(n.contentSelector)[0],n),n.animate){var l=c(window).scrollTop()+c(n.loading.msg).height()+n.extraScrollPx+"px";c("html,body").animate({scrollTop:l},800,function(){n.state.isDuringAjax=!1})}n.animate||(n.state.isDuringAjax=!1),a(this,t,i),n.prefill&&this._prefill()}},_nearbottom:function(){var e=this.options,t=0+c(document).height()-e.binder.scrollTop()-c(window).height();return e.behavior&&this["_nearbottom_"+e.behavior]!==d?this["_nearbottom_"+e.behavior].call(this):(this._debug("math:",t,e.pixelsFromNavToBottom),t-e.bufferPx<e.pixelsFromNavToBottom)},_pausing:function(e){var t=this.options;if(!t.behavior||this["_pausing_"+t.behavior]===d){switch("pause"!==e&&"resume"!==e&&null!==e&&this._debug("Invalid argument. Toggling pause value instead"),e=!e||"pause"!==e&&"resume"!==e?"toggle":e){case"pause":t.state.isPaused=!0;break;case"resume":t.state.isPaused=!1;break;case"toggle":t.state.isPaused=!t.state.isPaused}return this._debug("Paused",t.state.isPaused),!1}this["_pausing_"+t.behavior].call(this,e)},_setup:function(){var e=this.options;return e.behavior&&this["_setup_"+e.behavior]!==d?void this["_setup_"+e.behavior].call(this):(this._binding("bind"),!1)},_showdonemsg:function(){var e=this.options;return e.behavior&&this["_showdonemsg_"+e.behavior]!==d?void this["_showdonemsg_"+e.behavior].call(this):(e.loading.msg.find("img").hide().parent().find("div").html(e.loading.finishedMsg).animate({opacity:1},2e3,function(){c(this).parent().fadeOut(e.loading.speed)}),void e.errorCallback.call(c(e.contentSelector)[0],"done"))},_validate:function(e){for(var t in e)if(t.indexOf&&-1<t.indexOf("Selector")&&0===c(e[t]).length)return this._debug("Your "+t+" found no elements."),!1;return!0},bind:function(){this._binding("bind")},destroy:function(){return this.options.state.isDestroyed=!0,this.options.loading.finished(),this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},beginAjax:function(n){var a,s,e,r,l=this,t=n.path;if(n.state.currPage++,n.maxPage!==d&&n.state.currPage>n.maxPage)return n.state.isBeyondMaxPage=!0,void this.destroy();switch(a=c(c(n.contentSelector).is("table, tbody")?"<tbody/>":"<div/>"),s="function"==typeof t?t(n.state.currPage):t.join(n.state.currPage),l._debug("heading into ajax",s),e="html"===n.dataType||"json"===n.dataType?n.dataType:"html+callback",n.appendCallback&&"html"===n.dataType&&(e+="+callback"),e){case"html+callback":l._debug("Using HTML via .load() method"),a.load(s+" "+n.itemSelector,d,function(e){l._loadcallback(a,e,s)});break;case"html":l._debug("Using "+e.toUpperCase()+" via $.ajax() method"),c.ajax({url:s,dataType:n.dataType,complete:function(e,t){(r=void 0!==e.isResolved?e.isResolved():"success"===t||"notmodified"===t)?l._loadcallback(a,e.responseText,s):l._error("end")}});break;case"json":l._debug("Using "+e.toUpperCase()+" via $.ajax() method"),c.ajax({dataType:"json",type:"GET",url:s,success:function(e,t,i){if(r=void 0!==i.isResolved?i.isResolved():"success"===t||"notmodified"===t,n.appendCallback)if(n.template!==d){var o=n.template(e);a.append(o),r?l._loadcallback(a,o):l._error("end")}else l._debug("template must be defined."),l._error("end");else r?l._loadcallback(a,e,s):l._error("end")},error:function(){l._debug("JSON ajax request failed."),l._error("end")}})}},retrieve:function(e){e=e||null;var t=this.options;return t.behavior&&this["retrieve_"+t.behavior]!==d?void this["retrieve_"+t.behavior].call(this,e):t.state.isDestroyed?(this._debug("Instance is destroyed"),!1):(t.state.isDuringAjax=!0,void t.loading.start.call(c(t.contentSelector)[0],t))},scroll:function(){var e=this.options,t=e.state;return e.behavior&&this["scroll_"+e.behavior]!==d?void this["scroll_"+e.behavior].call(this):void(t.isDuringAjax||t.isInvalidPage||t.isDone||t.isDestroyed||t.isPaused||this._nearbottom()&&this.retrieve())},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(e){c.isPlainObject(e)&&(this.options=c.extend(!0,this.options,e))}},c.fn.infinitescroll=function(t,i){switch(typeof t){case"string":var o=Array.prototype.slice.call(arguments,1);this.each(function(){var e=c.data(this,"infinitescroll");return!(!e||!c.isFunction(e[t])||"_"===t.charAt(0))&&void e[t].apply(e,o)});break;case"object":this.each(function(){var e=c.data(this,"infinitescroll");e?e.update(t):(e=new c.infinitescroll(t,i,this)).failed||c.data(this,"infinitescroll",e)})}return this};var n,e=c.event;e.special.smartscroll={setup:function(){c(this).bind("scroll",e.special.smartscroll.handler)},teardown:function(){c(this).unbind("scroll",e.special.smartscroll.handler)},handler:function(e,t){var i=this,o=arguments;e.type="smartscroll",n&&clearTimeout(n),n=setTimeout(function(){c(i).trigger("smartscroll",o)},"execAsap"===t?0:100)}},c.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}});